local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local Backpack = LocalPlayer:WaitForChild("Backpack")
local favoriteEvent = ReplicatedStorage:WaitForChild("GameEvents"):WaitForChild("Favorite_Item")
local Players = game:GetService("Players")
local GuiService = game:GetService("GuiService")
local RunService = game:GetService("RunService")

getgenv().fruit = getgenv().fruit or 1
getgenv().eggEnhance = getgenv().eggEnhance or false
getgenv().fruitToFave = getgenv().fruitToFave or {}

local Fluent = loadstring(game:HttpGet("https://raw.githubusercontent.com/discoart/FluentPlus/refs/heads/main/Beta.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Jay Hub | Developer Version Egg Enhancer",
    SubTitle = "Testing",
    Icon = "132940723895184",
    TabWidth = 180,
    Size = UDim2.fromOffset(490, 360),
    Acrylic = true, 
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl,
    UserInfo = true,
    UserInfoTop = true,
    UserInfoTitle = game:GetService("Players").LocalPlayer.DisplayName,
    UserInfoSubtitle = "Welcome to Jay Hub!",
    UserInfoSubtitleColor = Color3.fromRGB(71, 123, 255)
})

local Minimizer = Fluent:CreateMinimizer({
  Icon = "132940723895184",
  Size = UDim2.fromOffset(44, 44),
  Position = UDim2.new(0, 320, 0, 24),
  Acrylic = true,
  Corner = 10,
  Transparency = 1,
  Draggable = true,
  Visible = true
})

local main_tab = Window:AddTab({ Title = "Main", Icon = "home" })
local settings_tab = Window:AddTab({ Title = "Settings", Icon = "settings" })
Window:SelectTab(1)

main_tab:AddInput("FruitAmountInput", {
    Title = "Fruit to favorite",
    Default = tostring(getgenv().fruit or 1),
    Placeholder = "Enter how many fruits to favorite",
    Numeric = true,
    Finished = true
}):OnChanged(function(value)
    local number = tonumber(value)
    if number then
        getgenv().fruit = number
        print("Set fruit amount to:", number)
    end
end)

main_tab:AddDropdown("FruitTypeDropdown", {
    Title = "Fruit Type",
    Description = "Used to select which fruits to favorite",
    Values = {
        "Bone Blossom",
        "Maple Resin",
        "Candy Blossom"
    },
    Multi = true,
    Default = getgenv().fruitToFave
}):OnChanged(function(values)
    getgenv().fruitToFave = values
    print("Fruit types to favorite updated:")
    for fruitName, state in pairs(values) do
        if state then
            print(" -", fruitName)
        end
    end
end)

main_tab:AddToggle("EggEnhanceToggle", {
    Title = "Egg Enhance",
    Default = getgenv().eggEnhance or false
}):OnChanged(function(state)
    getgenv().eggEnhance = state
    print("Egg Enhance:", state and "ON" or "OFF")
end)

local fruits = {}

local function isSelectedFruitType(fValue)
    local selected = getgenv().fruitToFave or {}
    if type(selected) ~= "table" then
        return false
    end
    return selected[fValue] == true
end

local function updateFruits()
    fruits = {}
    for _, tool in ipairs(Backpack:GetChildren()) do
        local fValue = tool:GetAttribute("f")
        local bValue = tool:GetAttribute("b")
        if fValue ~= nil and bValue == "j" and isSelectedFruitType(fValue) then
            table.insert(fruits, tool)
            if #fruits == getgenv().fruit then
                break
            end
        end
    end
end

updateFruits()

local delayTime = 0.05
local elapsed = 0
local currentIndex = 1

RunService.Heartbeat:Connect(function(dt)
    if not getgenv().eggEnhance then
        return
    end

    elapsed += dt
    if elapsed < delayTime then
        return
    end
    elapsed = 0

    updateFruits()

    if #fruits == 0 then
        currentIndex = 1
        return
    end

    if currentIndex > #fruits then
        currentIndex = 1
        return
    end

    local tool = fruits[currentIndex]
    currentIndex += 1

    if tool and tool.Parent == Backpack then
        favoriteEvent:FireServer(tool)
    end
end)

SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})

InterfaceManager:SetFolder("JayHubScripts")
SaveManager:SetFolder("JayHubScripts/Script-Game")
InterfaceManager:BuildInterfaceSection(settings_tab)
SaveManager:BuildConfigSection(settings_tab)

Fluent:Notify({
    Title = "Jay Hub - Free Scripts",
    Content = "Jay Hub has been loaded.",
    Duration = 5
})

SaveManager:LoadAutoloadConfig()
